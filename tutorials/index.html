
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../setup/">
      
      
        <link rel="next" href="configuration/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.0, mkdocs-material-9.1.20">
    
    
      
        <title>Adding Services - CloudWeGo API Gateway</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adding-services" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CloudWeGo API Gateway" class="md-header__button md-logo" aria-label="CloudWeGo API Gateway" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CloudWeGo API Gateway
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Adding Services
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="http://github.com/tim-pipi/cloudwego-api-gateway" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CloudWeGo API Gateway" class="md-nav__button md-logo" aria-label="CloudWeGo API Gateway" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CloudWeGo API Gateway
  </label>
  
    <div class="md-nav__source">
      <a href="http://github.com/tim-pipi/cloudwego-api-gateway" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        CloudWeGo API Gateway Documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Adding Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Adding Services
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#adding-services_1" class="md-nav__link">
    Adding Services
  </a>
  
    <nav class="md-nav" aria-label="Adding Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-the-idl-directory" class="md-nav__link">
    Setting up the IDL directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-your-first-service-echo-service" class="md-nav__link">
    Creating your first service: Echo Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-the-idl-file" class="md-nav__link">
    Understanding the IDL file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-the-rpc-server-using-kitex" class="md-nav__link">
    Generating the RPC Server using Kitex
  </a>
  
    <nav class="md-nav" aria-label="Generating the RPC Server using Kitex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updating-handlers" class="md-nav__link">
    Updating handlers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#starting-the-api-gateway" class="md-nav__link">
    Starting the API Gateway
  </a>
  
    <nav class="md-nav" aria-label="Starting the API Gateway">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-api-gateway" class="md-nav__link">
    Testing the API Gateway
  </a>
  
    <nav class="md-nav" aria-label="Testing the API Gateway">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-sending-a-get-request" class="md-nav__link">
    Step 1: Sending a GET Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-json-request-body" class="md-nav__link">
    Step 2: JSON Request Body
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-receiving-the-response" class="md-nav__link">
    Step 3: Receiving the Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="guidelines/" class="md-nav__link">
        Guidelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="observability/" class="md-nav__link">
        Observability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="updating-services/" class="md-nav__link">
        Updating Services
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#adding-services_1" class="md-nav__link">
    Adding Services
  </a>
  
    <nav class="md-nav" aria-label="Adding Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-the-idl-directory" class="md-nav__link">
    Setting up the IDL directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-your-first-service-echo-service" class="md-nav__link">
    Creating your first service: Echo Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-the-idl-file" class="md-nav__link">
    Understanding the IDL file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-the-rpc-server-using-kitex" class="md-nav__link">
    Generating the RPC Server using Kitex
  </a>
  
    <nav class="md-nav" aria-label="Generating the RPC Server using Kitex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updating-handlers" class="md-nav__link">
    Updating handlers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#starting-the-api-gateway" class="md-nav__link">
    Starting the API Gateway
  </a>
  
    <nav class="md-nav" aria-label="Starting the API Gateway">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-api-gateway" class="md-nav__link">
    Testing the API Gateway
  </a>
  
    <nav class="md-nav" aria-label="Testing the API Gateway">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-sending-a-get-request" class="md-nav__link">
    Step 1: Sending a GET Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-json-request-body" class="md-nav__link">
    Step 2: JSON Request Body
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-receiving-the-response" class="md-nav__link">
    Step 3: Receiving the Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="adding-services">Adding Services</h1>
<p>Welcome to CloudWeGo API Gateway!</p>
<p>In this guide, we'll walk you through the process of creating your first service with our API Gateway.
The CloudWeGo API Gateway operates using the Thrift IDL format, which allows you to define the structure of the request and response objects, as well as the service interface.</p>
<p>Before we begin, ensure that you have followed the instructions on the <a href="../setup/">Setup</a> page.</p>
<h2 id="adding-services_1">Adding Services</h2>
<p>In this section, we will guide you on how to add services to the CloudWeGo API Gateway and properly organize your Thrift IDL files.</p>
<h3 id="setting-up-the-idl-directory">Setting up the IDL directory</h3>
<p>Before adding services, it is crucial to have a designated directory to store all your Thrift IDL files.
To create this directory and set it as an environment variable, follow these steps in your terminal:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mkdir<span class="w"> </span>idl
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">IDL_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/idl&quot;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your IDL files have to follow the <a href="https://www.cloudwego.io/docs/kitex/tutorials/advanced-feature/generic-call/thrift_idl_annotation_standards/">Thrift IDL Annotation Standard</a> for Kitex.</p>
</div>
<h3 id="creating-your-first-service-echo-service">Creating your first service: Echo Service</h3>
<p>To demonstrate the process of adding a service, we will create a simple service named "EchoService."
Copy and paste the following code into a new file named /idl/echo.thrift:</p>
<div class="highlight"><pre><span></span><code><span class="kn">namespace</span><span class="w"> </span><span class="nn">go</span><span class="w"> </span><span class="n">api</span>

<span class="kd">struct</span><span class="w"> </span><span class="nc">EchoReq</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="k">required</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span>
<span class="p">}</span>

<span class="kd">struct</span><span class="w"> </span><span class="nc">EchoResp</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">response</span>
<span class="p">}</span>

<span class="kd">service</span><span class="w"> </span><span class="nc">EchoService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EchoResp</span><span class="w"> </span><span class="nf">echo</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">EchoReq</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">api.get</span><span class="o">=</span><span class="s2">&quot;/EchoService/echo&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="understanding-the-idl-file">Understanding the IDL file</h3>
<p>The /idl/echo.thrift file defines the "EchoService" with its request and response structures.
Let's go through the code:</p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>struct EchoReq...</code></td>
<td>Defines the structure representing the request object for the "Echo" operation.</td>
</tr>
<tr>
<td><code>struct EchoResp...</code></td>
<td>Defines the structure representing the response object for the "Echo" operation.</td>
</tr>
<tr>
<td><code>service EchoService...</code></td>
<td>Declares the service interface named "EchoService" that includes various operations.</td>
</tr>
<tr>
<td><code>(api.get="/EchoService/echo")</code></td>
<td>Specifies the path for the HTTP GET request to access the "echo" operation of the "EchoService".</td>
</tr>
</tbody>
</table>
<h2 id="generating-the-rpc-server-using-kitex">Generating the RPC Server using Kitex</h2>
<p>To generate the scaffolding code for the Kitex RPC server, follow these steps:</p>
<p>Create a new directory named <code>/rpc-server</code>.</p>
<p>Run the <code>cwgo gen</code> command with the <code>-i</code> flag to specify the path to the Thrift IDL file, and the <code>-m</code> flag to set the module name:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cwgo<span class="w"> </span>gen<span class="w"> </span>-i<span class="w"> </span>idl/echo.thrift<span class="w"> </span>-m<span class="w"> </span><span class="o">{</span>MODULE_NAME<span class="o">}</span>
Adding<span class="w"> </span>apache/thrift@v0.13.0<span class="w"> </span>to<span class="w"> </span>go.mod<span class="w"> </span><span class="k">for</span><span class="w"> </span>generated<span class="w"> </span>code<span class="w"> </span>..........<span class="w"> </span>Done
</code></pre></div>
<p>After running the command, the /rpc-server directory will contain the following files and subdirectories:</p>
<div class="highlight"><pre><span></span><code>├──<span class="w"> </span>Dockerfile
├──<span class="w"> </span>README.md
├──<span class="w"> </span>handler.go
├──<span class="w"> </span>idl
│<span class="w">   </span>└──<span class="w"> </span>echo.thrift
├──<span class="w"> </span>kitex-template
│<span class="w">   </span>├──<span class="w"> </span>handler_tpl.yaml
│<span class="w">   </span>├──<span class="w"> </span>main_tpl.yaml
│<span class="w">   </span>├──<span class="w"> </span>middleware_tpl.yaml
│<span class="w">   </span>└──<span class="w"> </span>readme_tpl.yaml
├──<span class="w"> </span>kitex_gen
│<span class="w">   </span>└──<span class="w"> </span>api
│<span class="w">       </span>├──<span class="w"> </span>echo.go
│<span class="w">       </span>├──<span class="w"> </span>echo_validator.go
│<span class="w">       </span>├──<span class="w"> </span>echoservice
│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>client.go
│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>echoservice.go
│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>invoker.go
│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>server.go
│<span class="w">       </span>├──<span class="w"> </span>k-consts.go
│<span class="w">       </span>└──<span class="w"> </span>k-echo.go
├──<span class="w"> </span>main.go
└──<span class="w"> </span>middleware
<span class="w">    </span>└──<span class="w"> </span>middleware.go
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>cwgo</code> command-line tool is a wrapper for the <code>kitex</code> command-line tool.
It is used to generate the scaffolding code for the Kitex RPC servers using
the a custom template for the API Gateway.</p>
</div>
<p>The <code>kitex</code> tool will generate the following <code>handler.go</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// EchoServiceImpl implements the last service interface defined in the IDL.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">EchoServiceImpl</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Echo implements the EchoServiceImpl interface.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">EchoServiceImpl</span><span class="p">)</span><span class="w"> </span><span class="nx">Echo</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">EchoReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">resp</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">EchoResp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// TODO: Your code here...</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="updating-handlers">Updating handlers</h3>
<p>In the <code>handler.go</code> file, fill in the logic for the Echo method:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// EchoServiceImpl implements the last service interface defined in the IDL.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">EchoServiceImpl</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Echo implements the EchoServiceImpl interface.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">EchoServiceImpl</span><span class="p">)</span><span class="w"> </span><span class="nx">Echo</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">EchoReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">resp</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">EchoResp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">resp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">EchoResp</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Response</span><span class="p">:</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">Message</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="starting-the-api-gateway">Starting the API Gateway</h2>
<p>To quickly get the API Gateway up and running, we recommend using Docker, which streamlines the deployment process.</p>
<p>Copy and paste the following <code>docker-compose.yml</code> file and start the API Gateway:</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.9&quot;</span><span class="w"> </span><span class="c1"># Docker version</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># etcd is used for service registration and discovery</span>
<span class="w">  </span><span class="nt">etcd</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/coreos/etcd:v3.5.0</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">[</span>
<span class="w">        </span><span class="s">&quot;etcd&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;--advertise-client-urls&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;http://etcd:2379&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;--listen-client-urls&quot;</span><span class="p p-Indicator">,</span>
<span class="w">        </span><span class="s">&quot;http://0.0.0.0:2379&quot;</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;2379:2379&quot;</span>
<span class="w">  </span><span class="c1"># http-server is the API Gateway which is pulled as a Docker image from Docker Hub</span>
<span class="w">  </span><span class="nt">http-server</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">czsheng/cloudwego-api-gateway</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">idl/:/etc/idl</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway-logs:/logs</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ETCD_ADDR=http://etcd:2379</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOGFILE=/logs/http-server.log</span>
<span class="w">    </span><span class="c1"># Port forwarding configuration for API Gateway</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">etcd</span>
<span class="w">  </span><span class="c1"># Code for RPC server</span>
<span class="w">  </span><span class="nt">rpc-server</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rpc-server</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ETCD_URL=http://etcd:2379</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINER=rpc-server</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOGFILE=/logs/rpc-server.log</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway-logs:/logs</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8888:8888&quot;</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">etcd</span>
<span class="c1"># Save logs to a persistent volume</span>
<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gateway-logs</span><span class="p">:</span>
</code></pre></div>
<h3 id="configuration">Configuration</h3>
<p>To customise the configuration, see the <a href="configuration/">Configuration</a> page.</p>
<h2 id="testing-the-api-gateway">Testing the API Gateway</h2>
<p>To test your API Gateway, you can use various HTTP client tools such as Insomnia, Postman, or Hurl.
Follow the steps below to test the API Gateway with a simple RPC server.</p>
<h3 id="step-1-sending-a-get-request">Step 1: Sending a GET Request</h3>
<ol>
<li>
<p>Start the API Gateway and the RPC server by running <code>docker-compose up</code>.</p>
</li>
<li>
<p>Open your preferred HTTP client tool (e.g., Insomnia, Postman, or Hurl).</p>
</li>
<li>
<p>Set the method to <code>GET</code>.</p>
</li>
<li>
<p>Enter the following URL as the request endpoint: <code>http://localhost:8080/EchoService/echo</code>.</p>
</li>
</ol>
<h3 id="step-2-json-request-body">Step 2: JSON Request Body</h3>
<ol>
<li>In the request body section of your HTTP client, provide the following JSON body:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello!&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="step-3-receiving-the-response">Step 3: Receiving the Response</h3>
<ol>
<li>
<p>Send the GET request by clicking the "Send" or "Run" button in your HTTP client.</p>
</li>
<li>
<p>You should receive the following JSON response:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;response&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello!&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>Congratulations! You have successfully set up the CloudWeGo API Gateway with a simple RPC server,
and the test confirms that it is functioning correctly.
If you encounter any issues or have questions, refer to the documentation or seek help from the community. Happy building!</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>